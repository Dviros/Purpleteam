### Hunting CVE-2023-23397 exploitations

### links:
- https://www.microsoft.com/en-us/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/
- https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_webdav_client_susp_execution.yml
- https://twitter.com/ACEResponder/status/1636116096506818562
- https://microsoft.github.io/CSS-Exchange/Security/CVE-2023-23397/

### Detection ideas:

#### Network Outbound connections:

  - üñ•Ô∏è [Windows Logs] Public IP address in : 
    - `Microsoft-Windows-SMBClient/Operational` 
    - `Microsoft-Windows-SMBClient/Connectivity`
    - `Security` EventID 5156 (SMB) & 5145
 
  - üîç [Sysmon] EID 3 / [EDR network telemetry]:
    - image outlook.exe & dest port 445
      - I assumed the SMB outbound connections would be pinned to the process outlook.exe at first but it really is initiated by SYSTEM processs ntoskrnl.exe so this detection idea is not relevant here

  - üöß [Firewall logs]:
    -  dest port 445 from internal IPs to external IPs

  - üåê [Proxy logs]: 
    - External IPs in HTTP requests (no domain name) for WebClient requests with davclnt.dll (`regex url =^(http|https|tunnel)\:\/\/\d*\.\d*\.\d*\.\d*\/[\W|\w]`)
    - url ending with `.wav`
 
#### Process executions:
  - :file_cabinet: Registry modifications (Windows `Security` EID 4657 or `Sysmon` EID 12,13,14 or `EDR registry telemetry`) :
    - `HKCU\Software\Microsoft\Office\*\Outlook\Tasks`
    - `HKCU\Software\Microsoft\Office\*\Outlook\Notes`
    - Could be used for correlations only (indicate that a reminder was triggered for a Note or Task item)
  - Suspicious WebDAV Process Creation events, 
    - Public IP address in rundll32 commandline
    - file .wav in rundll32 commandline 
    - example observed:
      - Parent process command line: C:\Windows\system32\svchost.exe -k LocalService -p -s WebClient
      - Child process command line: rundll32.exe C:\Windows\system32\davclnt.dll,DavSetCookie <IP Address> hxxp://<Threat actor IP>/folder/sound.wav
  - svchost spawns rundll32 w/attacker UNC path
  - svchost makes distinct HTTP requests

#### Exchange environment:
  - :e-mail: if access is available: Scan for messages with malicious properties https://microsoft.github.io/CSS-Exchange/Security/CVE-2023-23397/

### Splunk searches:
  
